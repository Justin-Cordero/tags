<style>
  td { text-align: center; }
  tr.bb { border-bottom: 2px solid black !important; }
  .bb table { border-collapse:collapse; }
</style>

# Student Handout - Session 1

## Agenda
1. Intro & Setting Up Your Environment
1. Basic Unix & Shell
1. Git Data Model - The Three Objects
1. Managing Local Changes - The Three Trees
1. Git vs Github - Know the difference

## Intro & Setting up your environment
Start with the forked-and-cloned repo.  See the [Prework](prework-session-1) for fork & clone instructions.

## Basic Unix & Shell
Review [Basic Unix and Shell](unix-shell-concepts).

### Unpack the git objects that Github.com has packed
```
$ ls .git/objects  # Not much there
$ ls -1 .git/objects/pack  # NOTE: -1, not -l
pack-cd347441ac47e2b50da184be5d8f0456b814e307.idx
pack-cd347441ac47e2b50da184be5d8f0456b814e307.pack
$ bin/unpack-objects.sh
$ ls .git/objects  # That's more like it!
$ ls .git/objects/pack  # Now the packfiles are gone.
$
```

### Activate git aliases, append to profile

This will set you up with cool shortcuts to see what's going on with your repo state.
```
$ cat git-aliases.sh
$ ls -l *.sh
$ bin/git-aliases.sh   # Activate aliases in current shell
$ bin/append-aliases-to-profile.sh  # So they'll be part of future shells.
$ adog  # This should work now.
```

### Review the prework
- Get the webapp running
- Explore the code

## Exploring the git repo - SHAs and objects

#### The git database
The git DB is "a content-addressable filesystem".&nbsp;  That is, objects are looked up ("addressed") based on their content.  How is this done?
```
$ git rev-parse HEAD
281fe7833c7693e7e1c45f62fae663620609e596
$ ls .git/objects/28
1fe7833c7693e7e1c45f62fae663620609e596
```
Where did the '281fe783...' string come from?  It's the address of the latest commit, generated by running that content through a SHA-1 hashing algorithm.

How do we know it's a commit?
```
$ git cat-file -t 281fe
commit
```

What's actually _in_ the commit?  Use "-p" instead of "-t" ...
```
$ git cat-file -p 281fe
tree 156304ad342cbf34c3b1e61da6aa7985d84e4309
parent 2535514b1e59cfc1f4ea915b60416cc50892870a
author Chris Walquist <chris@walquist.net> 1584470018 -0500
committer Chris Walquist <chris@walquist.net> 1584470018 -0500

checkpoint checkin; moving to work laptop
```

Test your understanding: Describe the relationship between a SHA and a git repo object.

#### Exercise: Commit hi.txt through "normal git commands"

Create a ```hi.txt``` file with a line or two of content in it, and commit it into the repo, using the customary ```git add``` and ```git commit``` (or their equivalent aliases)

- What SHA corresponds to the commit?
- Can you find that SHA under .git/objects?
- Extra credit (we haven't covered this yet): Using ```git cat-file -p```, can you trace from the commit SHA, all the way to the blob SHA that contains the actual contents of ```hi.txt```?  HINT: there is a 'tree' SHA between the 'commit' and the 'blob', which is revealed through judicious use of ```git cat-file -p```.  What is the SHA of that blob?
- How would you print the contents of your file, using ```git cat-file -p```?

#### While we're here...What else can we see in .git?
```
$ cd .git
$ ls -l
$ file HEAD
HEAD: ASCII text
$ cat HEAD
ref: refs/heads/master
$ file refs/heads/master
refs/heads/master: ASCII text
$ cat !$  # BANG-dolla!
fc223df6e6f71a506f9bda0fac71b16041fd7004  # Ymmv
$ ls -l refs
$ ls -l refs/remotes
$ ls -l refs/remotes/origin
$ file refs/remotes/origin/master
$ cat !$
fc223df6e6f71a506f9bda0fac71b16041fd7004
```

So how is HEAD stored in the git repo?  How about local and remote branches?

## The Three Git Objects - Commit, Tree, Blob

What kind of SHA is HEAD?
```
$ git cat-file -t HEAD
commit
```
What kind of SHA is dbf76?
```
$ git cat-file -t dbf76
tree
$ git cat-file -p dbf76
100644 blob c9c6a4764cbda4159c7b52ca482591781a112676	.gitignore
100644 blob 5631893229153119d48409a40cd1becbc6c6cdc6	README.md
100644 blob a310c7e86c777da617a004fabb78553b55d0270a	app.py
040000 tree 814d9a6020db87984ebc6682d14559724d48fb5d	bin
100644 blob 5aa6763729268efa1efa0dbc0ee36ebd9482405a	config.py
100644 blob 719b71285df083da25fa967460beee0a520df64c	config.yml.sample
040000 tree 37662bae83b27c1590682104446c2f84f480032a	config
040000 tree 409ee6d7a0a9a55a226ab9540cc3966a092de6ae	db
040000 tree 620b631bf1ea3e02295d0df6753d4ad76f9b6c79	lib
040000 tree 699db5cfd3a99f58c4425ffa26cb619b47901179	models
100644 blob 724359a3cb6fdb6e0d599c1f3d8cfb4385463d4d	requirements.frozen
100644 blob 69aa02c6edabc2fbfd0ad2e7f70fed0f1a7e9fcb	requirements.txt

$ git cat-file -p c9c6a4
__pycache__
venv
*.swp
*.pyc
*.sqlite3
```

What kind of SHA is c9c6a4?

Consider this git object diagram, courtesy of git-scm.com:

![](https://git-scm.com/book/en/v2/images/data-model-3.png "Git Data Model")

What SHAs from your repo (whether commit, tree, or blob) would correspond to this diagram's latest commit?

So there they are:  __The Three Objects__.  __commit__, __tree__, and __blob__. Next up: How do they work in practice?

## The Three Trees - HEAD, Index, Workspace

Git manages three trees in normal operation:

| Tree | Role |
| ---- | ---- |
| HEAD | The latest commit |
| Index | The commit-in-progress |
| Workspace | Your local filesystem |

On the 'green path' (that is, no mistakes or side journeys), changes start in the __workspace__ and flow to the __index__ via ```git add```, and finally into the repo via ```git commit``` (i.e., the branch to which __HEAD__ points moves to the next commit):

| __Affected tree:__ | Workspace | Index | HEAD
| --- | ---- | ---- |
| __Operation:__ | \<edit file\> | ```git add``` | ```git commit```

See also this workflow diagram, from git-scm.com:

![](https://git-scm.com/book/en/v2/images/reset-workflow.png)

Sometimes it's necessary to move changes the other way--for instance, when you need to add a forgotten file, change a commit message, or revert a commit.

```git reset```: The command that can assist with all this and more.  Why is it called "reset"?  Possibly because it resets trees to a state that already exists in the repo.  Unlike ```git add``` and ```git commit```, which push new states __into__ the repo, ```git reset``` pulls existing state the other way, __out__ of the repo, and into one or more of HEAD, the index, and even the workspace.

| Tree | Role | ```git reset``` "hardness"<br>needed to move the tree
| ---- | ---- | ----
| HEAD | The latest commit | \--soft
| Index | The commit-in-progress | \--mixed (also moves HEAD.) The default.
| Workspace | Your local filesystem | \--hard (also moves HEAD and Index.)

```git reset``` needs to know two things:
1. The "hardness"--that is, how many trees are to be reset, and
2. Which commit SHA to align the tree(s) with.

If you just type "git reset", the default hardness is "\--mixed", and the default commit SHA is HEAD.

## Putting It Together - Moving Objects Among Trees

Let's follow a file through its lifecycle, starting with workspace changes, which will flow through the index, and into a commit.  Then, we'll revert it, tree by tree, all the way back using ```git reset```.

### 1. Move a change forward through the trees

Make a change (which tree are you working in now, as you run the following commands?) ...
```
$ vim views.py (or use your preferred editor)
[Add a comment to the top--something prefixed with "#"--and save]
$ git status  # or 'gs' alias
$ git diff  # or 'gd' alias
```

Add to the index.
```
$ git add views.py   # or 'ga' aFile.txt
$ git status
$ git diff
$ git diff --staged   # or 'gds'
```

Which tree (or trees) have the change now?

Commit it...
```
$ git rev-parse HEAD
$ git commit -m "Commented in views.py"  # or use the 'gc' alias: gc -m "..."
$ git status
```

Now which tree (or trees) have the change?

### 2. Move the same change backward through the trees

Recall that besides specifying "hardness", we need to tell ```git reset``` the commit-SHA to align with--that is, which SHA to reset to.

(What is the previous value of HEAD?)
```
$ git rev-parse HEAD
$ git reset
$ git rev-parse HEAD   # What happened?  Why?
$ git rev-parse HEAD^   # What does the caret (^) mean?*
$ git status
$ git reset --soft <previous-value-of-head>
$ git rev-parse HEAD
$ git status
$ git diff
$ git diff --staged
```

\* To understand ^, ~, @{push}, and other revision notation, see [Git Revisions](https://git-scm.com/docs/revisions){:target="_blank"}.

What happened?  What is ```git status``` telling you, and why?

What happened to the commit that we were on before doing a ```git reset```?  How might we get back to it?

Now the branch that HEAD points to has been "reset", back to where it was before we committed.  Which tree has changed?

Let's change the next tree...
```
$ git reset   # Same command, but now something  happened.  Why?
$ git status
$ git diff
$ git diff --staged
```

What changed this time?

Let's change the third tree...
```
$ git reset --hard
$ git status
$ git diff
$ git diff --staged
```

Test your understanding:
- What happened to each tree at each step?
- How is ```git reset <paths>``` the opposite of ```git add <paths>```?
- When would each variation of ```git reset``` come in handy?

### Another picture of how ```"git reset --soft/mixed/hard <ToThisCommit>"``` &nbsp;works

<!-- Github Markdown doesn't do colspan -->
<table class="bb">
<tr><th>"hardness"</th><th colspan="3">Trees that are reset &lt;ToThisCommit&gt;</th></tr>
<tr class="bb"><th></th><th>Workspace</th><th>Index</th><th>HEAD</th></tr>
<tr><td>--soft</td><td>-</td><td>-</td><td>YES</td></tr>
<tr><td>--mixed</td><td>-</td><td>YES</td><td>YES</td></tr>
<tr><td>--hard</td><td>YES</td><td>YES</td><td>YES</td></tr>
</table>

## Git versus Github

The git client is a big bag of commands for implementing version control using a local content-addressable DB (aka a repository, or "repo"), as well as efficiently communicating with other, remote repos\--a Distributed Version Control System, or DVCS.  Git was written by Linus Torvalds in 2005 for version-controlling the Linux kernel.

In 2008, the social platform https://github.com came into existence, built around the git client.

When working with git and github, it's useful to keep in mind which operations belong to which system.  For instance...

| git | github |
| --- | --- |
| clone | fork |
| commit | |
| push | |
| pull | pull request |
| merge | |
| repo | repo |
| | org |
| | team, collaborator, org owner |
